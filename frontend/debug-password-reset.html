<!DOCTYPE html>
<html>
<head>
    <title>Password Reset Debug</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ddd; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .output { margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; word-break: break-all; max-height: 200px; overflow-y: auto; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
    </style>
</head>
<body>
    <h1>Teacher Password Reset - Debug Page</h1>
    
    <div class="test">
        <h3>1. Test Verify User Endpoint</h3>
        <input type="text" id="username" placeholder="Username" value="teacher1">
        <input type="text" id="role" placeholder="Role" value="teacher">
        <button onclick="testVerifyUser()">Test Verify User</button>
        <div id="verifyOutput" class="output"></div>
    </div>

    <div class="test">
        <h3>2. Test Password Reset Request Endpoint</h3>
        <input type="text" id="resetUsername" placeholder="Username" value="teacher1">
        <input type="text" id="resetRole" placeholder="Role" value="teacher">
        <input type="password" id="newPassword" placeholder="New Password" value="newpass123">
        <button onclick="testPasswordReset()">Test Password Reset</button>
        <div id="resetOutput" class="output"></div>
    </div>

    <div class="test">
        <h3>3. Check Server Health</h3>
        <button onclick="testServerHealth()">Check Server</button>
        <div id="healthOutput" class="output"></div>
    </div>

    <script>
        async function testVerifyUser() {
            const username = document.getElementById("username").value;
            const role = document.getElementById("role").value;
            const output = document.getElementById("verifyOutput");

            output.textContent = "Loading...";
            
            try {
                const response = await fetch("/api/auth/verify-user", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, role })
                });

                const data = await response.json();
                output.textContent = `Status: ${response.status}\n\n${JSON.stringify(data, null, 2)}`;
                output.classList.add(response.ok ? "success" : "error");
            } catch (err) {
                output.textContent = `ERROR: ${err.message}`;
                output.classList.add("error");
            }
        }

        async function testPasswordReset() {
            const username = document.getElementById("resetUsername").value;
            const role = document.getElementById("resetRole").value;
            const newPassword = document.getElementById("newPassword").value;
            const output = document.getElementById("resetOutput");

            output.textContent = "Loading...";
            
            try {
                const response = await fetch("/api/auth/request-password-reset", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, role, newPassword })
                });

                const data = await response.json();
                output.textContent = `Status: ${response.status}\n\n${JSON.stringify(data, null, 2)}`;
                output.classList.add(response.ok ? "success" : "error");
            } catch (err) {
                output.textContent = `ERROR: ${err.message}`;
                output.classList.add("error");
            }
        }

        async function testServerHealth() {
            const output = document.getElementById("healthOutput");
            output.textContent = "Loading...";
            
            try {
                const response = await fetch("/api/auth/me", {
                    method: "GET"
                });

                output.textContent = `Server Status: ${response.status} (${response.statusText})\n\nServer is responding.`;
                output.classList.add("success");
            } catch (err) {
                output.textContent = `SERVER ERROR: ${err.message}\n\nServer may not be running or there's a network issue.`;
                output.classList.add("error");
            }
        }
    </script>
</body>
</html>
