<div class="card-grid">
  <!-- Greeting Tile -->
  <div class="card greeting-tile w-2">
    <div class="greeting-content">
      <h2 class="greeting-heading" data="common.welcome"></h2>
      <p class="greeting-subtext">You are logged in as an Administrator</p>
    </div>
    <img
      src="/assets/images/teacher-clipart.svg"
      alt="Illustration"
      class="greeting-img"
    />
  </div>

  <!-- School Overview -->
  <div class="card dashboard-tile w-1 h-2" id="school-overview">
    <div class="icon-title">
      <i class="fas fa-school icon"></i>
      <p class="tile-label">School Overview</p>
    </div>
    <div class="stats-content">
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <span class="stat-number" id="total-students">-</span>
        <span class="stat-label">Students</span>
      </div>
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
        <span class="stat-number" id="total-teachers">-</span>
        <span class="stat-label">Teachers</span>
      </div>
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-building"></i>
        </div>
        <span class="stat-number" id="total-classes">-</span>
        <span class="stat-label">Classes</span>
      </div>
    </div>
  </div>

  <!-- Today's Attendance Overview -->
  <div class="card dashboard-tile" id="attendance-overview">
    <div class="icon-title">
      <i class="fas fa-clipboard-check icon"></i>
      <p class="tile-label">Today's Attendance</p>
    </div>
    <div id="attendance-overview-content">
      <!-- Content will be injected by JS -->
    </div>
  </div>

  <!-- System Status -->
  <div class="card dashboard-tile" id="system-status">
    <div class="icon-title">
      <i class="fas fa-server icon"></i>
      <p class="tile-label">System Status</p>
    </div>
    <div class="stats-content">
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-check-circle text-success"></i>
        </div>
        <span class="stat-number">Online</span>
        <span class="stat-label">Database</span>
      </div>
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-check-circle text-success"></i>
        </div>
        <span class="stat-number">Active</span>
        <span class="stat-label">Services</span>
      </div>
    </div>
  </div>

  <!-- Pending Tasks -->
  <div class="card dashboard-tile flex-column">
    <div class="icon-title">
      <i class="fas fa-tasks icon"></i>
      <p class="tile-label">Pending Tasks</p>
    </div>
    <div>
      <ul class="tile-list">
        <li>Review teacher applications</li>
        <li>Approve student registrations</li>
        <li>Generate reports</li>
        <li>System maintenance</li>
      </ul>
    </div>
  </div>

  <!-- Recent Announcements -->
  <div class="card dashboard-tile flex-column">
    <div class="icon-title">
      <i class="fas fa-bullhorn icon"></i>
      <p class="tile-label" data="sidebar.announcements"></p>
    </div>
    <div>
      <ul class="tile-list" id="announcements-list">
        <!-- Announcements will be loaded here -->
      </ul>
    </div>
  </div>

  <!-- Recent Activities -->
  <div class="card dashboard-tile flex-column">
    <div class="icon-title">
      <i class="fas fa-history icon"></i>
      <p class="tile-label">Recent Activities</p>
    </div>
    <div>
      <ul class="tile-list" id="activities-list">
        <li>New student registered</li>
        <li>Teacher updated profile</li>
        <li>Class schedule modified</li>
        <li>Marks uploaded</li>
      </ul>
    </div>
  </div>
</div>

<script>
  // Load school overview statistics (using mock data for now)
  async function loadSchoolOverview() {
    try {
      // For now, use mock data - in production these would be real API calls
      document.getElementById("total-students").textContent = "245";
      document.getElementById("total-teachers").textContent = "18";
      document.getElementById("total-classes").textContent = "12";

      // Uncomment below when real API endpoints are available:
      /*
      // Load total students
      const studentsRes = await fetch("/api/admin/students/count");
      if (studentsRes.ok) {
        const studentsData = await studentsRes.json();
        document.getElementById("total-students").textContent = studentsData.count || "-";
      }

      // Load total teachers
      const teachersRes = await fetch("/api/admin/teachers/count");
      if (teachersRes.ok) {
        const teachersData = await teachersRes.json();
        document.getElementById("total-teachers").textContent = teachersData.count || "-";
      }

      // Load total classes
      const classesRes = await fetch("/api/admin/classes/count");
      if (classesRes.ok) {
        const classesData = await classesRes.json();
        document.getElementById("total-classes").textContent = classesData.count || "-";
      }
      */
    } catch (err) {
      console.error("Error loading school overview:", err);
    }
  }

  // Load today's attendance overview for the whole school (using mock data for now)
  async function loadAttendanceOverview() {
    try {
      // Mock data - in production this would be a real API call
      const mockData = {
        presentCount: 198,
        totalStudents: 245
      };

      const container = document.getElementById("attendance-overview-content");
      const presentPercentage = Math.round((mockData.presentCount / mockData.totalStudents) * 100);

      container.innerHTML = `
        <div class="stats-content">
          <div class="stat-item">
            <div class="stat-icon">
              <i class="fas fa-user-check"></i>
            </div>
            <span class="stat-number">${mockData.presentCount}/${mockData.totalStudents}</span>
            <span class="stat-label">Present Today</span>
          </div>
          <div class="stat-item">
            <div class="stat-icon">
              <i class="fas fa-percentage"></i>
            </div>
            <span class="stat-number">${presentPercentage}%</span>
            <span class="stat-label">Attendance Rate</span>
          </div>
        </div>
      `;

      // Uncomment below when real API endpoint is available:
      /*
      const dateStr = (() => {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, "0");
        const dd = String(today.getDate()).padStart(2, "0");
        return `${yyyy}-${mm}-${dd}`;
      })();

      const res = await fetch(`/api/admin/attendance/overview?date=${dateStr}`);
      if (res.ok) {
        const data = await res.json();

        if (data.totalStudents > 0) {
          const presentPercentage = Math.round((data.presentCount / data.totalStudents) * 100);

          container.innerHTML = `
            <div class="stats-content">
              <div class="stat-item">
                <div class="stat-icon">
                  <i class="fas fa-user-check"></i>
                </div>
                <span class="stat-number">${data.presentCount}/${data.totalStudents}</span>
                <span class="stat-label">Present Today</span>
              </div>
              <div class="stat-item">
                <div class="stat-icon">
                  <i class="fas fa-percentage"></i>
                </div>
                <span class="stat-number">${presentPercentage}%</span>
                <span class="stat-label">Attendance Rate</span>
              </div>
            </div>
          `;
        } else {
          container.innerHTML = `
            <p class="text-sm">No attendance data available</p>
          `;
        }
      } else {
        container.innerHTML = `
          <p class="text-sm">Unable to load attendance data</p>
        `;
      }
      */
    } catch (err) {
      console.error("Error loading attendance overview:", err);
      document.getElementById("attendance-overview-content").innerHTML = `
        <p class="text-sm">Error loading attendance data</p>
      `;
    }
  }

  // Load recent announcements for admin dashboard (using mock data for now)
  async function loadAdminAnnouncements() {
    try {
      // Mock data - in production this would be a real API call
      const mockAnnouncements = [
        { title: "School Reopening Notice", posted_by_name: "Principal" },
        { title: "PTA Meeting Tomorrow", posted_by_name: "Admin Office" },
        { title: "Sports Day Postponed", posted_by_name: "Sports Coordinator" },
        { title: "New Library Books Available", posted_by_name: "Librarian" },
        { title: "Grade 10 Exam Schedule", posted_by_name: "Exam Controller" }
      ];

      const announcementsList = document.getElementById("announcements-list");

      // Show only the first 4 announcements
      const recentAnnouncements = mockAnnouncements.slice(0, 4);

      announcementsList.innerHTML = recentAnnouncements
        .map(
          (announcement) => `
            <li onclick="window.location.href='layout.html?role=admin&page=announcements'" style="cursor: pointer;">
              <span class="subject-name">${announcement.title}</span>
              <span class="text-sm text-muted">by ${announcement.posted_by_name}</span>
            </li>
          `
        )
        .join("");

      // If there are more than 4 announcements, add a "View all" item
      if (mockAnnouncements.length > 4) {
        announcementsList.innerHTML += `
          <li onclick="window.location.href='layout.html?role=admin&page=announcements'" style="cursor: pointer; border-top: 1px solid var(--color-border); margin-top: 8px; padding-top: 8px;">
            <span class="subject-name text-sm">View all announcements...</span>
          </li>
        `;
      }

      // Uncomment below when real API endpoint is available:
      /*
      const res = await fetch("/api/admin/announcements/recent");
      if (!res.ok) throw new Error("Failed to fetch announcements");

      const announcements = await res.json();

      if (!announcements || announcements.length === 0) {
        announcementsList.innerHTML =
          '<li class="text-sm">No recent announcements</li>';
        return;
      }

      // Show only the first 4 announcements
      const recentAnnouncements = announcements.slice(0, 4);

      announcementsList.innerHTML = recentAnnouncements
        .map(
          (announcement) => `
            <li onclick="window.location.href='layout.html?role=admin&page=announcements'" style="cursor: pointer;">
              <span class="subject-name">${announcement.title}</span>
              <span class="text-sm text-muted">by ${announcement.posted_by_name}</span>
            </li>
          `
        )
        .join("");

      // If there are more than 4 announcements, add a "View all" item
      if (announcements.length > 4) {
        announcementsList.innerHTML += `
          <li onclick="window.location.href='layout.html?role=admin&page=announcements'" style="cursor: pointer; border-top: 1px solid var(--color-border); margin-top: 8px; padding-top: 8px;">
            <span class="subject-name text-sm">View all announcements...</span>
          </li>
        `;
      }
      */
    } catch (err) {
      console.error("Error loading announcements:", err);
      const announcementsList = document.getElementById("announcements-list");
      announcementsList.innerHTML =
        '<li class="text-sm">Error loading announcements</li>';
    }
  }

  // Load recent activities (using mock data for now)
  async function loadRecentActivities() {
    try {
      // Mock data - in production this would be a real API call
      const mockActivities = [
        { description: "New student registered", timestamp: "2 hours ago" },
        { description: "Teacher updated profile", timestamp: "4 hours ago" },
        { description: "Class schedule modified", timestamp: "6 hours ago" },
        { description: "Marks uploaded for Grade 10-A", timestamp: "1 day ago" },
        { description: "New announcement posted", timestamp: "1 day ago" }
      ];

      const activitiesList = document.getElementById("activities-list");

      activitiesList.innerHTML = mockActivities
        .slice(0, 4)
        .map(
          (activity) => `
            <li>
              <span class="subject-name">${activity.description}</span>
              <span class="text-sm text-muted">${activity.timestamp}</span>
            </li>
          `
        )
        .join("");

      // Uncomment below when real API endpoint is available:
      /*
      const res = await fetch("/api/admin/activities/recent");
      if (!res.ok) throw new Error("Failed to fetch activities");

      const activities = await res.json();

      if (!activities || activities.length === 0) {
        activitiesList.innerHTML =
          '<li class="text-sm">No recent activities</li>';
        return;
      }

      activitiesList.innerHTML = activities
        .slice(0, 4)
        .map(
          (activity) => `
            <li>
              <span class="subject-name">${activity.description}</span>
              <span class="text-sm text-muted">${activity.timestamp}</span>
            </li>
          `
        )
        .join("");
      */
    } catch (err) {
      console.error("Error loading activities:", err);
      const activitiesList = document.getElementById("activities-list");
      activitiesList.innerHTML =
        '<li class="text-sm">Error loading activities</li>';
    }
  }

  // Initialize admin dashboard
  async function initAdminDashboard() {
    await loadSchoolOverview();
    loadAttendanceOverview();
    loadAdminAnnouncements();
    loadRecentActivities();
  }

  initAdminDashboard();
</script>