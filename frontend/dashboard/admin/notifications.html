<h2 class="heading">
  <i class="fas fa-bell"></i>
  <span data-en="Notifications" data-si="à¶¯à·à¶±à·”à¶¸à·Šà¶¯à·“à¶¸à·Š" data-ta="à®…à®±à®¿à®µà®¿à®ªà¯à®ªà¯à®•à®³à¯">Notifications</span>
</h2>

<!-- ðŸ”¹ Send Notification -->
<div class="card dashboard-tile">
  <div class="icon-title">
    <i class="fas fa-plus icon"></i>
    <p class="tile-label" data-en="Send New Notification" data-si="à¶±à·€ à¶¯à·à¶±à·”à¶¸à·Šà¶¯à·“à¶¸à¶šà·Š à¶ºà·€à¶±à·Šà¶±" data-ta="à®ªà¯à®¤à®¿à®¯ à®…à®±à®¿à®µà®¿à®ªà¯à®ªà¯ˆ à®…à®©à¯à®ªà¯à®ªà¯">
      Send New Notification
    </p>
  </div>
  <form id="notificationForm">
    <label for="recipient" data-en="Recipients" data-si="à¶½à¶¶à¶±à·Šà¶±à¶±à·Š" data-ta="à®ªà¯†à®±à¯à®¨à®°à¯à®•à®³à¯">Recipients</label>
    <select id="recipient" class="dropdown-select" required>
      <option value="all" data-en="All Users" data-si="à·ƒà·’à¶ºà¶½à·”à¶¸ à¶´à¶»à·’à·à·“à¶½à¶šà¶ºà·’à¶±à·Š" data-ta="à®…à®©à¯ˆà®¤à¯à®¤à¯ à®ªà®¯à®©à®°à¯à®•à®³à¯">All Users</option>
      <option value="students" data-en="All Students" data-si="à·ƒà·’à¶ºà¶½à·”à¶¸ à·ƒà·’à·ƒà·”à¶±à·Š" data-ta="à®…à®©à¯ˆà®¤à¯à®¤à¯ à®®à®¾à®£à®µà®°à¯à®•à®³à¯">All Students</option>
      <option value="teachers" data-en="All Teachers" data-si="à·ƒà·’à¶ºà¶½à·”à¶¸ à¶œà·”à¶»à·”à¶±à·Š" data-ta="à®…à®©à¯ˆà®¤à¯à®¤à¯ à®†à®šà®¿à®°à®¿à®¯à®°à¯à®•à®³à¯">All Teachers</option>
      <option value="grade10" data-en="Grade 10" data-si="10 à·à·Šâ€à¶»à·šà¶«à·’à¶º" data-ta="à®¤à®°à®®à¯ 10">Grade 10</option>
    </select>

    <label for="title" data-en="Title" data-si="à¶¸à·à¶­à·˜à¶šà·à·€" data-ta="à®¤à®²à¯ˆà®ªà¯à®ªà¯">Title</label>
    <input type="text" id="title" placeholder="Enter notification title" required />

    <label for="message" data-en="Message" data-si="à¶´à¶«à·’à·€à·’à¶©à¶º" data-ta="à®šà¯†à®¯à¯à®¤à®¿">Message</label>
    <textarea id="message" rows="3" placeholder="Enter message" required></textarea>

    <button type="submit" class="btn"><i class="fas fa-paper-plane"></i>
      <span data-en="Send" data-si="à¶ºà·€à¶±à·Šà¶±" data-ta="à®…à®©à¯à®ªà¯à®ªà¯">Send</span>
    </button>
  </form>
</div>

<!-- ðŸ”¹ Edit Notification Section -->
<div class="card dashboard-tile" id="editSection" style="display:none;">
  <div class="icon-title">
    <i class="fas fa-edit icon"></i>
    <p class="tile-label" data-en="Edit Notification" data-si="à¶¯à·à¶±à·”à¶¸à·Šà¶¯à·“à¶¸ à·ƒà¶‚à·ƒà·Šà¶šà¶»à¶«à¶º" data-ta="à®…à®±à®¿à®µà®¿à®ªà¯à®ªà¯ˆ à®¤à®¿à®°à¯à®¤à¯à®¤à¯">
      Edit Notification
    </p>
  </div>
  <form id="editForm">
    <input type="hidden" id="editId" />
    <label data-en="Title" data-si="à¶¸à·à¶­à·˜à¶šà·à·€" data-ta="à®¤à®²à¯ˆà®ªà¯à®ªà¯">Title</label>
    <input type="text" id="editTitle" required />

    <label data-en="Message" data-si="à¶´à¶«à·’à·€à·’à¶©à¶º" data-ta="à®šà¯†à®¯à¯à®¤à®¿">Message</label>
    <textarea id="editMessage" rows="3" required></textarea>

    <div class="action-container">
      <button type="submit" class="btn"><i class="fas fa-save"></i>
        <span data-en="Save Changes" data-si="à·€à·™à¶±à·ƒà·Šà¶šà¶¸à·Š à·ƒà·”à¶»à¶šà·’à¶±à·Šà¶±" data-ta="à®®à®¾à®±à¯à®±à®™à¯à®•à®³à¯ˆ à®šà¯‡à®®à®¿">Save Changes</span>
      </button>
      <button type="button" class="btn btn-secondary" onclick="cancelEdit()">
        <i class="fas fa-times"></i>
        <span data-en="Cancel" data-si="à¶…à·€à¶½à¶‚à¶œà·”" data-ta="à®°à®¤à¯à®¤à¯ à®šà¯†à®¯à¯">Cancel</span>
      </button>
    </div>
  </form>
</div>

<!-- ðŸ”¹ Search Notifications -->
<div class="card dashboard-tile">
  <div class="icon-title">
    <i class="fas fa-search icon"></i>
    <p class="tile-label" data-en="Search Notifications" data-si="à¶¯à·à¶±à·”à¶¸à·Šà¶¯à·“à¶¸à·Š à·ƒà·™à·€à·“à¶¸" data-ta="à®…à®±à®¿à®µà®¿à®ªà¯à®ªà¯à®•à®³à¯ˆà®¤à¯ à®¤à¯‡à®Ÿà¯à®¤à®²à¯">
      Search Notifications
    </p>
  </div>
  <input type="text" id="searchInput" placeholder="Search by title or message..." onkeyup="renderNotifications()" />

  <div class="table-responsive">
    <table id="notificationTable">
      <thead>
        <tr>
          <th>Title</th>
          <th>Recipient</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="notificationBody"></tbody>
    </table>
  </div>
</div>

<!-- ðŸ”¹ Modal for Viewing -->
<div id="viewModal" class="modal-overlay" style="display:none;">
  <div class="modal-card">
    <div class="modal-header">
      <h3 data-en="Notification Details" data-si="à¶¯à·à¶±à·”à¶¸à·Šà¶¯à·“à¶¸à·š à·€à·’à·ƒà·Šà¶­à¶»" data-ta="à®…à®±à®¿à®µà®¿à®ªà¯à®ªà¯ à®µà®¿à®µà®°à®™à¯à®•à®³à¯">Notification Details</h3>
      <button class="btn btn-secondary btn-small" onclick="closeModal()"><i class="fas fa-times"></i> Close</button>
    </div>
    <div id="modalContent" class="modal-content"></div>
  </div>
</div>

<!-- ðŸ”¹ Back Button -->
<div class="action-container">
  <a href="layout.html?role=admin&page=dashboard" class="btn back-btn">
    <i class="fas fa-arrow-left"></i>
    <span data-en="Back to Dashboard" data-si="à¶©à·‘à·‚à·Šà¶¶à·à¶©à·Š à·€à·™à¶­" data-ta="à®Ÿà®¾à®·à¯à®ªà¯‹à®°à¯à®Ÿà¯à®•à¯à®•à¯ à®¤à®¿à®°à¯à®®à¯à®ª">Back to Dashboard</span>
  </a>
</div>

<!-- âœ… Scripts -->
<script>
let notifications = JSON.parse(localStorage.getItem("notifications")) || [
  { id: 1, title: "Parent Meeting", message: "Grade 10 Parent Meeting on Sept 5, 9.00 a.m.", recipient: "grade10", date: "2025-08-29" },
  { id: 2, title: "Holiday Notice", message: "Milad-Un-Nabi holiday on Sept 15.", recipient: "all", date: "2025-08-27" }
];

// âœ… Save Notification
document.getElementById("notificationForm").addEventListener("submit", e => {
  e.preventDefault();
  const recipient = document.getElementById("recipient").value;
  const title = document.getElementById("title").value.trim();
  const message = document.getElementById("message").value.trim();
  const date = new Date().toISOString().split("T")[0];

  if (!title || !message) return; // prevent empty

  notifications.push({ id: Date.now(), title, message, recipient, date });
  localStorage.setItem("notifications", JSON.stringify(notifications));
  renderNotifications();

  // âœ… clear form fields after sending
  document.getElementById("notificationForm").reset();
});

// âœ… Render Notifications
function renderNotifications() {
  const body = document.getElementById("notificationBody");
  const search = document.getElementById("searchInput").value.toLowerCase();
  const filtered = notifications.filter(n => n.title.toLowerCase().includes(search) || n.message.toLowerCase().includes(search));

  body.innerHTML = filtered.map(n => `
    <tr>
      <td>${n.title}</td>
      <td>${n.recipient}</td>
      <td>${n.date}</td>
      <td>
        <button class="btn btn-small" onclick="viewNotification(${n.id})"><i class="fas fa-eye"></i> View</button>
        <button class="btn btn-small" onclick="editNotification(${n.id})"><i class="fas fa-edit"></i> Edit</button>
        <button class="btn btn-danger btn-small" onclick="deleteNotification(${n.id})"><i class="fas fa-trash"></i> Delete</button>
      </td>
    </tr>
  `).join('');
  updateText(localStorage.getItem("lang") || "en");
}

// âœ… View Notification
function viewNotification(id) {
  const n = notifications.find(n => n.id == id);
  document.getElementById("modalContent").innerHTML = `
    <p><strong>Title:</strong> ${n.title}</p>
    <p><strong>Message:</strong> ${n.message}</p>
    <p><strong>Recipient:</strong> ${n.recipient}</p>
    <p><strong>Date:</strong> ${n.date}</p>`;
  document.getElementById("viewModal").style.display = "flex";
}

function closeModal() {
  document.getElementById("viewModal").style.display = "none";
}

// âœ… Edit Notification
function editNotification(id) {
  const n = notifications.find(n => n.id == id);
  document.getElementById("editSection").style.display = "block";
  document.getElementById("editId").value = n.id;
  document.getElementById("editTitle").value = n.title;
  document.getElementById("editMessage").value = n.message;
}

document.getElementById("editForm").addEventListener("submit", e => {
  e.preventDefault();
  const id = document.getElementById("editId").value;
  const title = document.getElementById("editTitle").value.trim();
  const message = document.getElementById("editMessage").value.trim();
  const index = notifications.findIndex(n => n.id == id);
  notifications[index].title = title;
  notifications[index].message = message;
  localStorage.setItem("notifications", JSON.stringify(notifications));
  renderNotifications();

  // âœ… auto-close edit section after saving
  cancelEdit();
});

function cancelEdit() {
  document.getElementById("editSection").style.display = "none";
  document.getElementById("editForm").reset();
}

// âœ… Delete
function deleteNotification(id) {
  if (confirm("Are you sure you want to delete this notification?")) {
    notifications = notifications.filter(n => n.id != id);
    localStorage.setItem("notifications", JSON.stringify(notifications));
    renderNotifications();
  }
}

// ðŸŒ Language persistence
function updateText(lang) {
  document.querySelectorAll("[data-en]").forEach(el => {
    el.textContent = el.getAttribute(`data-${lang}`) || el.getAttribute("data-en");
  });
}
window.addEventListener("storage", e => { if (e.key === "lang") updateText(e.newValue || "en"); });
window.addEventListener("languageChange", e => {
  const newLang = e.detail.lang || "en";
  localStorage.setItem("lang", newLang);
  updateText(newLang);
});
setInterval(() => {
  const currentLang = localStorage.getItem("lang") || "en";
  if (window._lastLang !== currentLang) {
    updateText(currentLang);
    window._lastLang = currentLang;
  }
}, 500);

renderNotifications();
</script>

<style>
.modal-overlay {position:fixed;inset:0;display:none;justify-content:center;align-items:center;background:rgba(0,0,0,0.4);}
.modal-card {background:var(--color-card);padding:20px;border-radius:12px;max-width:500px;width:90%;}
.table-responsive table {width:100%;border-collapse:collapse;}
.table-responsive th, .table-responsive td {padding:8px 12px;border-bottom:1px solid var(--color-border);}
.table-responsive tr:hover {background:var(--color-hover);}
.action-container {margin-top:15px;}
</style>
