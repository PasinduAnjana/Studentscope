<h2 class="heading">
  <i class="fas fa-chart-line"></i>
  <span data="sidebar.marks"></span>
</h2>

<div class="card-grid">
  <!-- Class Rank Card -->
  <div class="card w-1 h-1 dashboard-tile" id="classRankCard">
    <div class="icon-title">
      <i class="fas fa-trophy icon"></i>
      <p
        class="tile-label"
        data-en="Class Rank"
        data-si="පන්තිය "
        data-ta="வகுப்பு தரம்"
      >
        Class Rank
      </p>
    </div>
    <div class="stats-content">
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-hashtag"></i>
        </div>
        <span class="stat-number" id="classRank">Loading...</span>
        <span
          class="stat-label"
          id="totalStudentsLabel"
          data-en="Out of -"
          data-si="- න්"
          data-ta="- இல் அதிகமாக"
          >Out of -</span
        >
      </div>
    </div>
  </div>
</div>

<script>
  async function loadMarksData() {
    try {
      const response = await api.student.marks.getRank();
      if (response.ok) {
        const data = await response.json();
        
        // Update Rank
        const rankElement = document.getElementById("classRank");
        if (data.rank && data.rank !== "N/A") {
          // Format rank with ordinal suffix (1st, 2nd, 3rd, etc.)
          const j = data.rank % 10,
            k = data.rank % 100;
          let suffix = "th";
          if (j == 1 && k != 11) suffix = "st";
          if (j == 2 && k != 12) suffix = "nd";
          if (j == 3 && k != 13) suffix = "rd";
          rankElement.textContent = data.rank + suffix;
        } else {
          rankElement.textContent = "N/A";
        }

        // Update Total Students
        const totalLabel = document.getElementById("totalStudentsLabel");
        totalLabel.setAttribute("data-en", `Out of ${data.totalStudents}`);
        totalLabel.setAttribute("data-si", `${data.totalStudents} න් එක`);
        totalLabel.setAttribute("data-ta", `${data.totalStudents} இல் அதிகமாக`);
        
        // Trigger translation update if function exists, or manually update English
        // Assuming a translation function exists or it defaults to English initially
        totalLabel.textContent = `Out of ${data.totalStudents}`; 
      } else {
        console.error("Failed to fetch rank data");
        document.getElementById("classRank").textContent = "Error";
      }
    } catch (error) {
      console.error("Error loading marks data:", error);
      document.getElementById("classRank").textContent = "Error";
    }
  }

  // Load marks data on page load
  loadMarksData();
</script>
